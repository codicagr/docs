# Tags
Eίναι Translatable, έχει Permissions και Access. Μπορεί να εμφανιστεί ως content σε site. Υπάρχει στο CDP. 
Δεν έχει καμία σχέση με το `Cache::tags('x')` που υπάρχει σε πολλά σημεία σε admin & site.

Η οντότητα καθ' αυτή είναι απλή και δε γίνεται κάτι σύνθετο για αυτή στο Admin. Έχει τα πεδία `hidden` και `not_in_cdp`:
* `hidden (boolean)`: για να κρυφτεί το Tag από το site (θα χρησιμοποιηθεί όταν εμφανιστούν ως περιεχόμενο τα Tags σε site)
* `not_in_cdp (boolean)`: αν είναι true, το Tag αυτό δε θα λαμβάνεται υπόψιν από το CDP (θα αγνοείται από αυτό σε κάθε επίπεδο)

### Tag Category
1 Tag μπορεί να έχει έως 1 Tag Category. Παραδείγματα Tag Categories: brands, locations, shopping-category. Έχουν και αυτά το `not_in_cdp` και το `hidden` σαν πεδίο και λειτουργεί
με την ίδια λογική όπως και στο Tag. Ωστόσο, αν ένα Tag έχει Tag Category που δεν λαμβάνεται υπόψιν από το CDP, δε θα ληφθεί ούτε το ίδιο υπόψιν από το CDP.

### Σύνδεση με άλλες οντότητες
Τα Tags συνδέονται με τις εξής οντότητες:
* **Item** 
* **Category**
* Menu
* Module
* User

Μέχρι στιγμής έχει χρησιμοποιηθεί η σύνδεση μόνο με Items και Categories. Ίσως στο μέλλον αφαιρεθεί η υποστήριξη σύνδεσης με κάποιο από τα υπόλοιπα μοντέλα.

H σύνδεση γίνεται μέσω του πίνακα `tag_connections`. Η σύνδεση είναι `Polymorphic`. Πάνω στη σύνδεση υπάρχουν τα πεδία `order, weight, main`:
* order (int): Σε περίπτωση που χρειάζεται κάποια ταξινόμηση των Tags (για εμφάνιση στο site, δεν έχει χρειαστεί μέχρι στιγμής)
* weight (double): Αφορά το CDP. Ένας συντελεστής που ορίζει τη σημασία του Tag για τη συνδεδεμένη με αυτό εγγραφή.
* main (boolean): Έχει χρειαστεί σε ορισμένες περιπτώσεις (π.χ. Brands, Locations) να χρειαζόμαστε Tag που να συμβολίζει μια εγγραφή (Item/Category). Αυτή η σχέση ορίζεται μέσω του πεδίου αυτού (με true).

### Σύνδεση με άλλες οντότητες (ρυθμίσεις και προσθήκες κώδικα στο Admin)
Για να μπορέσει να συνδεθεί μια εγγραφή μιας από τις υποστηριζόμενες οντότητες με Tags, απαιτούνται τα ακόλουθα: 
* Δήλωση του relation στο μοντέλο της οντότητας (π.χ. App\Models\Item.php):
```php
public function tags()
{
    return $this->morphToMany(Tag::class, 'tag_connections')->withTimestamps()->withPivot('weight', 'order');
}
```
Ακόμα, αν θέλουμε να υποστηριχθεί η λειτουργικότητα του 'Main Tag', πρέπει να προστεθεί στο μοντέλο της οντότητας και το εξής:
```php
public function getMainTagAttribute()
{
    return $this->tags()->withPivot('main')->where('main', true)->first();
}
```
Για να υπάρχει στη φόρμα η δυνατότητα να συνδεθούν Tags με μια εγγραφή μιας οντότητας, αρκεί να προστεθεί στο Config αρχείο του μοντέλου (π.χ. ItemConfig)
στη συνάρτηση ` public function getFieldsInForms($wireModelPath = null) `  το ακόλουθο:`php $this->getTagsTab(),` μέσα στο collection με τα πεδία της φόρμας.

Στις φόρμες της οντότητας (Create/Edit), πρέπει να χρησιμοποιηθεί το Trait ` WithTags `, το οποίο περιλαμβάνει όλη την απαραίτητη λειτουργικότητα. Ακόμα, πρέπει στις συναρτήσεις
`submitForm` & `makeCopy` να προστεθεί το: ` $this->saveTags($record); `, όπου $record η εγγραφή την οποία δημιουργούμε/επεξεργαζόμαστε εκείνη τη στιγμή.

Τα αρχεία που υλοποιούν τη λειτουργικότητα των Tags στις φόρμες άλλων οντοτήτων:
* `app/Traits/WithTags.php`
* `resources/views/admin/form/partials/tabs/tags-tab/main.blade`

### WithTags (Trait)
* Τα Tags φορτώνονται μόνο όταν ο διαχειριστής μπει στο tab "Tags", για λόγους performance και αποφυγής αχρείαστων queries. Κατά την είσοδο του διαχειριστή στο tab,
καλούνται οι `loadTags() -> getRecordTags()`. (Μια σημείωση εδώ είναι πως τα Tags συνδέονται με Items/Categories και όχι με ψευδομοντέλα, οπότε αν βρισκόμαστε σε φόρμα ψευδομοντέλου, 
θα χρησιμοποιηθεί το "parent model" του για την αναζήτηση και την αποθήκευση των Tags της εγγραφής)
* Κάθε φορά που πατάμε το κουμπί "Add" στο modal από το οποίο προσθέτουμε Tags, καλείται η `tagsUpdated()`
* Την τελική αποθήκευση των Tags τη διαχειρίζεται η `saveTags($record)`, καλούμενη από τη `submitForm()` ή τη `makeCopy()` της οντότητας στην οποία βρισκόμαστε.

### Tag Hierarchy
Δεν έχει υλοποιηθεί ακόμα. Συνοπτικά, ο Σκοπός του είναι να αποτυπώσει στα Tags κάτι παρόμοιο του 'depth' των Categories/Menus. Έτσι, τα γενικά Tags
(π.χ. Γυναικεία Μόδα, Ανδρική Μόδα, Παιδικά στα εμπορικά) θα έχουν μεγαλύτερο Hierarchy απ' ότι τα πιο συγκεκριμένα (π.χ. Tag ενός Brand ή "Γυναικεία Ρούχα"). 

### Order πάνω στο ίδιο το Tag
Θα χρησιμοποιηθεί σε περίπτωση που τα Tags εμφανιστούν σε site ως περιεχόμενο. Δεν έχει συμβεί μέχρι στιγμής

### Jobs/Αυτόματη Παραγωγή Tags
Αυτή η διαδικασία είναι συνδεδεμένη με τις ανάγκες του εκάστοτε Project. Στα sites των εμπορικών κέντρων για παράδειγμα υπάρχει η ανάγκη για αυτόματη δημιουργία Tags για
Stores, Brands (ψευδομοντέλα Item) & Product Categories (ψευδομοντέλο Category). Τα Jobs που σχετίζονται με την παραγωγή Tags/σύνδεση Tags με εγγραφές άλλων οντοτήτων θα
βρίσκονται στο φάκελο app/Jobs/Tags/

### CDP
Tα Tags παίζουν κομβικό ρόλο στη λειτουργία του CDP. Για αυτό, υπάρχουν ως οντότητα και σε αυτό. Όταν δημιουργείται/γίνεται update ένα Tag στο CMS, το CDP θα ενημερωθεί αντιστοίχως
(βλέπε app/Models/Tag.php συνάρτηση `boot() -> sendTagToCdp()`). Προφανώς αυτό συμβαίνει μόνο αν η κολώνα `not_in_cdp` του Tag είναι false & αν το Tag είναι enabled.
Η διαδικασία "περάσματος" των Tags από το CMS στο CDP γίνεται μαζικά και από το Job app/Jobs/Cdp/SyncTagsWithCdp.php